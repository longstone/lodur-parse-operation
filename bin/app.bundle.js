!function(e,t){for(var r in t)e[r]=t[r]}(exports,function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=31)}([function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("moment")},function(e,t,r){const n=function(e,t){return e.length>0?e.slice(-1).pop():t},o=function(e){return e.sort((function(e,t){return e.number-t.number})),e};e.exports={getLastEntry:n,getSendArray:function(e,t){const r=[];if(e&&e.length>0){const n=e.slice();o(n),n.reverse().every((function(e){return e.number>t.number&&(r.push(e),!0)}))}return r.reverse()},isOrderingForwards:function(e){return e.length>0&&e[0].number<n(e).number},sortArrayByNumber:o,containsDuplicatedID:function(e){if(!e)return!1;const t=new Set;e.map(e=>t.add(e.number));const n=!(e.length===t.size);if(n){let n=[];e.map(e=>n.push(e.number));let i=!1;for(var o of t.keys()){i=!1;for(var s=0;s<n.length;s++)n[s]!==o||i||(n[s]=null,i=!0)}let a=n.filter(e=>null!=e);r(0).log({level:"error",message:"duplicated element found, number: "+a})}return n},getServerIp:()=>process.env.NODE_IP||"localhost",getServerPort:()=>process.env.NODE_PORT||process.env.PORT||8080}},function(e,t,r){"use strict";var n=function(e){e||(e={}),this.timestamp=e.timestamp||"",this.group=e.group||"",this.description=e.description||"",this.number=e.number||-1};n.prototype.getTimestamp=function(){return this.timestamp},n.prototype.getGroup=function(){return this.group},n.prototype.getDescription=function(){return this.description},n.prototype.getNumber=function(){return this.nr},e.exports=n},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("mongoose")},function(e,t,r){const n=r(6),o=r(8),s=new n.Schema({timestamp:Date,text:String,error:{},description:String});let i;new o(s,"LogEntry").indexes({timestamp:1,error:-1}),i=n.models.LogEntry?n.model("LogEntry"):n.model("LogEntry",s),e.exports=i},function(e,t,r){const n=r(1);e.exports=class{constructor(e,t){this.schema=e,e.on("index",e=>{console.log(t+" index: "+n.get(e,"message","seems ok"))})}indexes(e){this.schema.index(e)}}},function(e,t){e.exports=require("path")},function(e,t,r){"use strict";var n=r(2);e.exports=function(e){var t=e.date,r=e.time;return n(t+" "+r,"DD.MM.YYYY HH.mm")}},function(e,t,r){"use strict";r(2);e.exports=function(e){var t=e.indexOf("- ")+2,r=e.indexOf(" Uhr");return e.substring(t,r)}},function(e,t,r){"use strict";r(2);e.exports=function(e){return e.split("+")}},function(e,t,r){"use strict";e.exports=function(e){const t=(r="/",n=2,e.split(r,n).join(r).length+1);var r,n;return e.substr(t).trim()}},function(e,t,r){"use strict";e.exports=function(e){return parseInt(e.substring(13,e.length).substring(0,3))}},function(e,t,r){const n=r(2);e.exports=class{constructor(e,t){this.LodurEntry=e.LodurEntry,this.Chats=e.Chats,this.LogEntry=e.LogEntry,this.logger=t.logger,this.query={entriesThisYear:{timestamp:{$gte:n().startOf("year").toDate()}},entriesLastYear:{timestamp:{$gte:n().startOf("year").subtract(1,"years").toDate()}}}}getLastEntryForYear(){return new Promise((e,t)=>{this.LodurEntry.find(this.query.entriesThisYear).sort({number:-1}).limit(1).exec((function(r,n){null===r?e(n):t(r)}))})}getLastEntryForLastYear(){return new Promise((e,t)=>{this.LodurEntry.find(this.query.entriesLastYear).sort({number:-1}).limit(1).exec((function(r,n){null===r?e(n):t(r)}))})}getEntriesForActualYear(){return this.LodurEntry.find(this.query.entriesThisYear).sort({number:-1}).exec()}getEntriesForLastYear(){return this.LodurEntry.find(this.query.entriesLastYear).sort({number:-1}).exec()}createNewLodurEntry(e){return new this.LodurEntry(e).save()}findChatsById(e){return new Promise((t,r)=>{this.Chats.find({chatId:e},(e,n)=>{null!==e?r({"err-find-chats-by-id":e}):t(n)})})}findAllChats(){return new Promise((e,t)=>{this.Chats.find({},(r,n)=>{null!=r?t({"err-find-all-chats":r}):e(n)})})}createChat(e){return new this.Chats(e).save()}log(e,t){this.logger.log("debug","persistence-service logged: "+e+" -> "+t),this.LogEntry.create({timestamp:new Date,text:e,error:t},(function(e){null!==e&&this.logger.log("error","persist new received Error",e)}))}}},function(e,t,r){const n=r(1),o=r(3);class s{constructor(e,t){this.req={},this.req.request=t.request,this.persistenceService=t.persistenceService,this.logger=t.logger,this.bot=this._initBot(e,this.logger),this.logger.log("debug","telegram-bot-service: construction")}_initBot(e,t){t.log("info","binding bot commands");const r=this;return e.on("error",e=>{this.logger.log("error","telegram-bot-service: Bot.onError -> "+JSON.stringify(e)),this.persistenceService.log("telegramMngr - received error: "+JSON.stringify(e),"Bot.onError:"+e)}).on("start",e=>{this.persistenceService.log("telegram-bot-service: cmd start: ",JSON.stringify(e)),this.persistenceService.findChatsById(e.chat.id).then(t=>{0===t.length?this.persistenceService.createChat({chatId:e.chat.id,firstName:e.chat.first_name,lastName:e.chat.last_name,type:e.chat.type,username:e.chat.username}).then(t=>{this.persistenceService.log("info","registered chat id "+e.chat.id),this._send(e.chat.id,"should be registered right now")}).catch(t=>{this.persistenceService.log("error","telegram-bot-service: error occured "+JSON.stringify(t)),this._send(e.chat.id,"should be registered right now")}):(this.persistenceService.log("error","already registered chat id "+e.chat.id),this._send(e.chat.id,"you're registered already, doing nothing..."))}).catch(e=>this.logger.log("error","telegram-bot-service: unknow error occured "+JSON.stringify(e)))}).on("stop",e=>{this.persistenceService.log("telegram-bot-service: cmd stop: ",JSON.stringify(e)),this.persistenceService.findChatsById(e.chat.id).then(t=>{n.each(t,t=>t.remove(t=>{let n="removed you from notification list";t&&(n="error while removing "+t),r._send(e.chat.id,n)}))})}).on("stats",e=>{this.persistenceService.log("telegram-bot-service: cmd stats: "+JSON.stringify(e)),this.persistenceService.findAllChats().then(t=>{const n="currently, im notifying "+s._chatOrChats(t.length);r._send(e.chat.id,n)}).catch(e=>{console.log("stats",e),r.logger("warn",JSON.stringify(e))})}).on("update",e=>{this.persistenceService.log("telegram-bot-service: cmd update: ",JSON.stringify(e)),this.req.request("http://"+o.getServerIp()+":"+o.getServerPort()+"/update",()=>{t.log("info","update from bot triggered"),r._send(e.chat.id,"update triggered")})}).start()}static _chatOrChats(e){const t=e+" chat";return e>1?t+"s":t}notifyAll(e){return new Promise((t,r)=>{this.persistenceService.findAllChats().then(r=>{r.map(t=>(this._send(t.chatId,e),!0)).every(()=>(t(r),!1))}).catch(e=>{this.persistenceService.log("telegram-bot-service.notifyAll: error",e),r({"error-find-all-chats":e})})})}_send(e,t){const r={chat_id:e,text:t};this.logger.log("debug","send "+JSON.stringify(r)),this.bot.sendMessage(r,(e,t)=>{e?this.persistenceService.log("telegramMngr - send: "+JSON.stringify(t)+"conf: "+JSON.stringify(r),JSON.stringify(e)):this.persistenceService.log("sucessful sent :"+JSON.stringify(t),"")})}}e.exports=s},function(e,t){e.exports=require("node-telegram-bot")},function(e,t,r){const n=r(6),o=r(8),s=new n.Schema({group:[String],timestamp:Date,description:String,number:Number});let i;new o(s,"LodurEntry").indexes({number:1,timestamp:-1}),i=n.models.LodurEntry?n.model("LodurEntry"):n.model("LodurEntry",s),e.exports=i},function(e,t,r){const n=r(6),o=r(8),s=new n.Schema({chatId:String,firstName:String,lastName:String,type:String,username:String});let i;new o(s,"Chat").indexes({chatId:1}),i=n.models.Chat?n.model("Chat"):n.model("Chat",s),e.exports=i},function(e,t){e.exports=require("request")},function(e,t,r){"use strict";var n=r(1),o=r.n(n);const s=r(7),i=r(3);t.a=class{constructor(e){this.import={express:e.express,pageloader:e.pageloader}}getRoute(){return(e,t)=>{this.import.pageloader.load().then(e=>{t.setHeader("charset","utf8"),i.containsDuplicatedID(e)&&t.json({error:"duplication, please contact admin"}),t.json(e)},(function(e){s.create({timestamp:new Date,text:"index - pageloader exception",error:JSON.stringify(e),description:o.a.get(e,"message","nomessage")+"\nstack:\n"+o.a.get(e,"stack","nostack")},(function(e){null!=e&&console.log("not able to write log Entry ",e)})),t.json({error:e})}))}}}},function(e,t,r){const n=r(1),o=r(2),s=r(3);e.exports=class{constructor(e){this.persistenceService=e.persistenceService,this.pageloader=e.pageloader,this.telegramBot=e.telegramBotService,this.logger=e.logger}getRoute(){return(e,t)=>{let r=n.get(e,"query.silent",!1);this.logger.log("debug","route-update: update requested"),Promise.all([this.persistenceService.getLastEntryForYear(),this.pageloader.load()]).then(e=>{try{const n=e[0],i=e[1];let a=[];if(s.containsDuplicatedID(i))this.logger.log("warn","duplicated ID in entries: ",JSON.stringify(i)),this.logger.log("warn","docs: ",JSON.stringify(n)),this.logger.log("warn","promise result: ",JSON.stringify(e));else{let e={number:-1};1===n.length&&(e=n[0]._doc),a=s.getSendArray(i,e),this.logger.log("info","route-update: elements to send ",a.length),a.length>0?s.sortArrayByNumber(a).forEach(e=>{try{this.logger.log("info","route-update: persisting item nr",e.number);const t={number:e.number,group:e.group,timestamp:e.timestamp,description:e.description};this.persistenceService.createNewLodurEntry(t).then(()=>{this.logger.log("info","route-update: persisted item nr",e.number);const t="Wer:  "+e.group.toString()+"\nWas:  "+e.description+"\nWann: "+o(e.timestamp).locale("de").format("HH:mm DD.MM.YY")+"\nNummer: "+e.number;this.telegramBot.notifyAll(t).then(e=>this.logger.log("info","total "+e.length+" notified"))}).catch(e=>this.logger.log("error","persist new Entry Error"+JSON.stringify(e)))}catch(e){this.logger.log("info","woohwohohwohowow"+e)}}):r&&this.logger.log("debug","no update, latest was: "+JSON.stringify(e))}t.json({newEntries:a})}catch(e){this.logger.log("error","route-update: exception occured: "+JSON.stringify(e)),t.json({"error-catch":e})}}).catch(e=>{this.persistenceService.log("error","route-update Promise.all err: "+JSON.stringify(e)),t.json({error:e})})}}}},function(e,t,r){const n=r(1),o=r(2),s=r(3);e.exports=class{constructor(e){this.persistenceService=e.persistenceService,this.pageloader=e.pageloader,this.telegramBot=e.telegramBotService,this.logger=e.logger}getRoute(){return(e,t)=>{let r=n.get(e,"query.silent",!1);this.logger.log("debug","route-update: update requested"),Promise.all([this.persistenceService.getLastEntryForLastYear(),this.pageloader("https://www.lodur-zh.ch/duebendorf/index.php?modul=6&year="+o().startOf("year").subtract(1,"years").get("year"))]).then(e=>{try{const n=e[0],i=e[1];let a=[];if(s.containsDuplicatedID(i))this.logger.log("warn","duplicated ID in entries: ",JSON.stringify(a));else{let e={number:-1};1===n.length&&(e=n[0]._doc),a=s.getSendArray(i,e),this.logger.log("info","route-update: elements to send ",a.length),a.length>0?s.sortArrayByNumber(a).forEach(e=>{try{this.logger.log("info","route-update: persisting item nr",e.number);const t={number:e.number,group:e.group,timestamp:e.timestamp,description:e.description};this.persistenceService.createNewLodurEntry(t).then(()=>{this.logger.log("info","route-update: persisted item nr",e.number);const t="Wer:  "+e.group.toString()+"\nWas:  "+e.description+"\nWann: "+o(e.timestamp).locale("de").format("HH:mm DD.MM.YY")+"\nNummer: "+e.number;this.telegramBot.notifyAll(t).then(e=>this.logger.log("info","total "+e.length+" notified"))}).catch(e=>this.logger.log("error","persist new Entry Error"+JSON.stringify(e)))}catch(e){this.logger.log("info","woohwohohwohowow"+e)}}):r&&this.logger.log("debug","no update, latest was: "+JSON.stringify(e))}t.json({newEntries:a})}catch(e){this.logger.log("error","route-update: exception occured: "+JSON.stringify(e)),t.json({"error-catch":e})}}).catch(e=>{this.persistenceService.log("error","route-update Promise.all err: "+JSON.stringify(e)),t.json({error:e})})}}}},function(e,t){e.exports=class{constructor(e){this.import={express:e.express,persistenceService:e.persistenceService,logger:e.logger}}getRoute(){return(e,t)=>{this.import.persistenceService.getEntriesForActualYear().then(e=>t.json({my_statistic:{type:"integer",value:e.length,label:"Einsätze im aktuellen Jahr"}}))}}}},function(e,t){class r{constructor(e,t,n){const o=r._stripCredentialsConnectionString(t);e.connect(t,{useNewUrlParser:!0,useUnifiedTopology:!0}).then(()=>n.log("info","Succeeded connected to: "+o),e=>n.log("error","ERROR connecting to: "+o+". "+e)).catch(e=>console.log("mongoose-connect: unhandled error",e))}static _stripCredentialsConnectionString(e){const t=e.indexOf("@");let r=0;return t>0&&(r=t),e.substring(r)}}e.exports=r},function(e,t,r){"use strict";var n=r(2);e.exports=function(e){var t=e.date,r=e.time;return n(t+" "+r,"DD.MM.YYYY HH.mm")}},function(e,t,r){"use strict";r(2);e.exports=function(e){const t=e.indexOf("- ");var r=t<=0?e.indexOf("– ")+2:t+2,n=e.indexOf(" Uhr");return e.substring(r,n)}},function(e,t,r){"use strict";r(2);e.exports=function(e){return e.split("+")}},function(e,t,r){"use strict";e.exports=function(e){const t=(r="/",n=2,e.split(r,n).join(r).length+1);var r,n;return e.substr(t).trim()}},function(e,t,r){"use strict";e.exports=function(e){return parseInt(e.substring(13,e.length).substring(0,3))}},function(e,t,r){"use strict";r.r(t),function(e){r(32),r(34);var n=r(15),o=r.n(n),s=r(16),i=r.n(s),a=r(17),c=r.n(a),u=r(18),l=r.n(u),g=r(19),p=r.n(g),h=r(7),d=r.n(h),f=r(1),m=r.n(f),v=r(20),y=r.n(v),S=r(5),b=r.n(S),x=r(0),w=r.n(x),O=r(21),E=r(22),N=r.n(E),L=r(23),P=r.n(L),_=r(24),q=r.n(_),C=r(3),j=r.n(C),M=r(25),R=r.n(M);r(33).install();const D=r(40);process.on("uncaughtException",(function(e){d.a.create({timestamp:new Date,text:"app.js - uncaughtException",error:JSON.stringify(e),description:m.a.get(e,"message","nomessage")+"\nstack:\n"+m.a.get(e,"stack","nostack")},(function(e){null!==e&&console.log("persist new Entry ",e)})),console.error((new Date).toUTCString()+" uncaughtException:"),console.error(e),console.error(e.message),console.error(e.stack)}));const J=r(9),k=(r(41),r(42),r(43)),T=r(44),Y=r(6),F=new(r(45).default),I=b()(),B=w.a.createLogger({level:"info",format:w.a.format.json(),defaultMeta:{service:"user-service"},transports:[new w.a.transports.Console({colorize:!0,level:"debug"}),new w.a.transports.File({filename:"error.log",level:"error"}),new w.a.transports.File({filename:"combined.log"})]});I.use(T.json()),I.use(T.urlencoded({extended:!1})),I.use(k()),I.use(b.a.static(J.join(e,"public")));const A={telegramToken:process.env.telegram_hash},H={express:b(),pageloader:F,persistenceService:new o.a({Chats:p(),LogEntry:d(),LodurEntry:l()},{logger:B}),logger:B,request:y(),telegramBotService:null},U=new c.a({token:A.telegramToken});H.telegramBotService=new i.a(U,H);const W=b.a.Router();W.get("/",new O.a(H).getRoute()),W.get("/update",new N.a(H).getRoute()),W.get("/update-last-year",new P.a(H).getRoute()),W.get("/stats-dasheroo",new q.a(H).getRoute()),I.use("/",W),I.use((function(e,t,r){B.log("warn","errorhandler ",e.originalUrl);const n=new Error("Not Found");n.status=404,r(n)}));const z=new D(process.env);z.setVariableNames(["MONGOURI","telegram_hash"]);const $=z.check();$.length>0&&B.log("warn","missing process.env variables: ",$),Y.Promise=global.Promise;global.Promise;const G=process.env.MONGOURI||"mongodb://localhost:27017/lodur";new R.a(Y,G,B),"development"===I.get("env")?(B.level="silly",B.warn("env:development"),Y.set("debug",!0),I.use((function(e,t,r,n){r.status(e.status||500),r.json({message:e.message,error:e})}))):I.use((function(e,t,r,n){B.log("error",e),r.status(e.status||500),r.json({message:e.message,error:{}})})),I.listen(j.a.getServerPort(),j.a.getServerIp(),(function(){B.log("info","Listening on server_port: "+j.a.getServerPort()),B.log("info","Listening on server_ip_address: "+j.a.getServerIp())})),t.default=I}.call(this,"/")},function(e,t,r){"use strict";r(0),r(4),r(10),r(11),r(12),r(13),r(14)},function(e,t){e.exports=require("source-map-support")},function(e,t,r){r(35).install()},function(e,t,r){(function(e){var n,o=r(37).SourceMapConsumer,s=r(9);try{(n=r(38)).existsSync&&n.readFileSync||(n=null)}catch(e){}var i=r(39);function a(e,t){return e.require(t)}var c=!1,u=!1,l=!1,g="auto",p={},h={},d=/^data:application\/json[^,]+base64,/,f=[],m=[];function v(){return"browser"===g||"node"!==g&&("undefined"!=typeof window&&"function"==typeof XMLHttpRequest&&!(window.require&&window.module&&window.process&&"renderer"===window.process.type))}function y(e){return function(t){for(var r=0;r<e.length;r++){var n=e[r](t);if(n)return n}return null}}var S=y(f);function b(e,t){if(!e)return t;var r=s.dirname(e),n=/^\w+:\/\/[^\/]*/.exec(r),o=n?n[0]:"",i=r.slice(o.length);return o&&/^\/\w\:/.test(i)?(o+="/")+s.resolve(r.slice(o.length),t).replace(/\\/g,"/"):o+s.resolve(r.slice(o.length),t)}f.push((function(e){if(e=e.trim(),/^file:/.test(e)&&(e=e.replace(/file:\/\/\/(\w:)?/,(function(e,t){return t?"":"/"}))),e in p)return p[e];var t="";try{if(n)n.existsSync(e)&&(t=n.readFileSync(e,"utf8"));else{var r=new XMLHttpRequest;r.open("GET",e,!1),r.send(null),4===r.readyState&&200===r.status&&(t=r.responseText)}}catch(e){}return p[e]=t}));var x=y(m);function w(e){var t=h[e.source];if(!t){var r=x(e.source);r?(t=h[e.source]={url:r.url,map:new o(r.map)}).map.sourcesContent&&t.map.sources.forEach((function(e,r){var n=t.map.sourcesContent[r];if(n){var o=b(t.url,e);p[o]=n}})):t=h[e.source]={url:null,map:null}}if(t&&t.map&&"function"==typeof t.map.originalPositionFor){var n=t.map.originalPositionFor(e);if(null!==n.source)return n.source=b(t.url,n.source),n}return e}function O(){var e,t="";if(this.isNative())t="native";else{!(e=this.getScriptNameOrSourceURL())&&this.isEval()&&(t=this.getEvalOrigin(),t+=", "),t+=e||"<anonymous>";var r=this.getLineNumber();if(null!=r){t+=":"+r;var n=this.getColumnNumber();n&&(t+=":"+n)}}var o="",s=this.getFunctionName(),i=!0,a=this.isConstructor();if(!(this.isToplevel()||a)){var c=this.getTypeName();"[object Object]"===c&&(c="null");var u=this.getMethodName();s?(c&&0!=s.indexOf(c)&&(o+=c+"."),o+=s,u&&s.indexOf("."+u)!=s.length-u.length-1&&(o+=" [as "+u+"]")):o+=c+"."+(u||"<anonymous>")}else a?o+="new "+(s||"<anonymous>"):s?o+=s:(o+=t,i=!1);return i&&(o+=" ("+t+")"),o}function E(e){var t={};return Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(r){t[r]=/^(?:is|get)/.test(r)?function(){return e[r].call(e)}:e[r]})),t.toString=O,t}function N(e,t){if(void 0===t&&(t={nextPosition:null,curPosition:null}),e.isNative())return t.curPosition=null,e;var r=e.getFileName()||e.getScriptNameOrSourceURL();if(r){var n=e.getLineNumber(),o=e.getColumnNumber()-1,s=/^v(10\.1[6-9]|10\.[2-9][0-9]|10\.[0-9]{3,}|1[2-9]\d*|[2-9]\d|\d{3,}|11\.11)/.test(process.version)?0:62;1===n&&o>s&&!v()&&!e.isEval()&&(o-=s);var i=w({source:r,line:n,column:o});t.curPosition=i;var a=(e=E(e)).getFunctionName;return e.getFunctionName=function(){return null==t.nextPosition?a():t.nextPosition.name||a()},e.getFileName=function(){return i.source},e.getLineNumber=function(){return i.line},e.getColumnNumber=function(){return i.column+1},e.getScriptNameOrSourceURL=function(){return i.source},e}var c=e.isEval()&&e.getEvalOrigin();return c?(c=function e(t){var r=/^eval at ([^(]+) \((.+):(\d+):(\d+)\)$/.exec(t);if(r){var n=w({source:r[2],line:+r[3],column:r[4]-1});return"eval at "+r[1]+" ("+n.source+":"+n.line+":"+(n.column+1)+")"}return(r=/^eval at ([^(]+) \((.+)\)$/.exec(t))?"eval at "+r[1]+" ("+e(r[2])+")":t}(c),(e=E(e)).getEvalOrigin=function(){return c},e):e}function L(e,t){l&&(p={},h={});for(var r=(e.name||"Error")+": "+(e.message||""),n={nextPosition:null,curPosition:null},o=[],s=t.length-1;s>=0;s--)o.push("\n    at "+N(t[s],n)),n.nextPosition=n.curPosition;return n.curPosition=n.nextPosition=null,r+o.reverse().join("")}function P(e){var t=/\n    at [^(]+ \((.*):(\d+):(\d+)\)/.exec(e.stack);if(t){var r=t[1],o=+t[2],s=+t[3],i=p[r];if(!i&&n&&n.existsSync(r))try{i=n.readFileSync(r,"utf8")}catch(e){i=""}if(i){var a=i.split(/(?:\r\n|\r|\n)/)[o-1];if(a)return r+":"+o+"\n"+a+"\n"+new Array(s).join(" ")+"^"}}return null}function _(e){var t=P(e);process.stderr._handle&&process.stderr._handle.setBlocking&&process.stderr._handle.setBlocking(!0),t&&(console.error(),console.error(t)),console.error(e.stack),process.exit(1)}m.push((function(e){var t,r=function(e){var t;if(v())try{var r=new XMLHttpRequest;r.open("GET",e,!1),r.send(null),t=4===r.readyState?r.responseText:null;var n=r.getResponseHeader("SourceMap")||r.getResponseHeader("X-SourceMap");if(n)return n}catch(e){}t=S(e);for(var o,s,i=/(?:\/\/[@#][\s]*sourceMappingURL=([^\s'"]+)[\s]*$)|(?:\/\*[@#][\s]*sourceMappingURL=([^\s*'"]+)[\s]*(?:\*\/)[\s]*$)/gm;s=i.exec(t);)o=s;return o?o[1]:null}(e);if(!r)return null;if(d.test(r)){var n=r.slice(r.indexOf(",")+1);t=i(n,"base64").toString(),r=e}else r=b(e,r),t=S(r);return t?{url:r,map:t}:null}));var q=f.slice(0),C=m.slice(0);t.wrapCallSite=N,t.getErrorSource=P,t.mapSourcePosition=w,t.retrieveSourceMap=x,t.install=function(t){if((t=t||{}).environment&&(g=t.environment,-1===["node","browser","auto"].indexOf(g)))throw new Error("environment "+g+" was unknown. Available options are {auto, browser, node}");if(t.retrieveFile&&(t.overrideRetrieveFile&&(f.length=0),f.unshift(t.retrieveFile)),t.retrieveSourceMap&&(t.overrideRetrieveSourceMap&&(m.length=0),m.unshift(t.retrieveSourceMap)),t.hookRequire&&!v()){var r=a(e,"module"),n=r.prototype._compile;n.__sourceMapSupport||(r.prototype._compile=function(e,t){return p[t]=e,h[t]=void 0,n.call(this,e,t)},r.prototype._compile.__sourceMapSupport=!0)}if(l||(l="emptyCacheBetweenOperations"in t&&t.emptyCacheBetweenOperations),c||(c=!0,Error.prepareStackTrace=L),!u){var o=!("handleUncaughtExceptions"in t)||t.handleUncaughtExceptions;try{!1===a(e,"worker_threads").isMainThread&&(o=!1)}catch(e){}o&&"object"==typeof process&&null!==process&&"function"==typeof process.on&&(u=!0,s=process.emit,process.emit=function(e){if("uncaughtException"===e){var t=arguments[1]&&arguments[1].stack,r=this.listeners(e).length>0;if(t&&!r)return _(arguments[1])}return s.apply(this,arguments)})}var s},t.resetRetrieveHandlers=function(){f.length=0,m.length=0,f=q.slice(0),m=C.slice(0),x=y(m),S=y(f)}}).call(this,r(36)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=require("source-map")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("buffer-from")},function(e,t){e.exports=class{constructor(e){this.process=e}setVariableNames(e){this.names=e.slice()}check(){return this.names.filter(e=>void 0===this.process[e])}}},function(e,t){e.exports=require("serve-favicon")},function(e,t){e.exports=require("express-winston")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("body-parser")},function(e,t,r){"use strict";r.r(t);const n=r(46).default,o=r(47),s=r(48);t.default=class{constructor(){this.parser=new s.default,this.cheerio=o,this.axios=n}parse(e){return this.parser.parse(e)}load(e){return new Promise((t,r)=>{let n=e||"https://www.lodur-zh.ch/duebendorf/index.php?modul=6";this.axios.get(n,{responseEncoding:"binary"}).then(this.htmlToLines.bind(this)).then(this.linesToEntries.bind(this)).then(t).catch(r)})}htmlToLines(e){let t=e.data,r=this.cheerio.load(t,{normalizeWhitespace:!0,xmlMode:!0}),n=r("div .content table"),o=[];return n.each((function(e,t){const n=r(t);o.push(n.text())})),o}linesToEntries(e){return e.shift(),e.map(e=>this.parse(e))}}},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("cheerio")},function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n),s=r(4),i=r.n(s),a=r(26),c=r.n(a),u=r(27),l=r.n(u),g=r(28),p=r.n(g),h=r(29),d=r.n(h),f=r(30),m=r.n(f);var v=class{constructor(){this.getSplitChar=function(){return"/"}}getTimestamp(e){const t={};return t.date=e.substring(0,"07.06.2020".length),t.time=l()(e),c()(t)}parse(e){try{const t=e.replace("  "," ").split(this.getSplitChar()).map(e=>e.trim());let r=p()(t[1]),n=this.getTimestamp(t[0]),o=m()(t[0]);const s={group:r,timestamp:n,description:d()(e),number:o};return new i.a(s)}catch(t){o.a.log("error: pageloader parse",t),o.a.log("info: ",e)}return new i.a({})}};t.default=v}]));
//# sourceMappingURL=app.bundle.js.map