(()=>{var e={413:e=>{"use strict";var t=function(e){e||(e={}),this.timestamp=e.timestamp||"",this.group=e.group||"",this.description=e.description||"",this.number=e.number||-1};t.prototype.getTimestamp=function(){return this.timestamp},t.prototype.getGroup=function(){return this.group},t.prototype.getDescription=function(){return this.description},t.prototype.getNumber=function(){return this.nr},e.exports=t},377:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});const n=r(167).default,s=r(48),o=r(284),i=class{constructor(){this.parser=new o.default,this.cheerio=s,this.axios=n}parse(e){return this.parser.parse(e)}load(e){return new Promise(((t,r)=>{let n=e||"https://www.lodur-zh.ch/duebendorf/index.php?modul=6";this.axios.get(n,{responseEncoding:"binary"}).then(this.htmlToLines.bind(this)).then(this.linesToEntries.bind(this)).then(t).catch(r)}))}htmlToLines(e){let t=e.data,r=this.cheerio.load(t,{normalizeWhitespace:!0,xmlMode:!0}),n=r("div .content table"),s=[];return n.each((function(e,t){const n=r(t);s.push(n.text())})),s}linesToEntries(e){return e.shift(),e.map((e=>this.parse(e)))}}},874:(e,t,r)=>{"use strict";var n=r(245);e.exports=function(e){var t=e.date,r=e.time;return n(t+" "+r,"DD.MM.YYYY HH.mm")}},797:e=>{"use strict";e.exports=function(e){const t=("/",2,e.split("/",2).join("/").length+1);return e.substr(t).trim()}},701:(e,t,r)=>{"use strict";r(245),e.exports=function(e){return e.split("+")}},17:e=>{"use strict";e.exports=function(e){return parseInt(e.substring(13,e.length).substring(0,3))}},633:(e,t,r)=>{"use strict";r(245),e.exports=function(e){var t=e.indexOf("- ")+2,r=e.indexOf(" Uhr");return e.substring(t,r)}},750:(e,t,r)=>{"use strict";var n=r(245);e.exports=function(e){var t=e.date,r=e.time;return n(t+" "+r,"DD.MM.YYYY HH.mm")}},990:e=>{"use strict";e.exports=function(e){const t=("/",2,e.split("/",2).join("/").length+1);return e.substr(t).trim()}},220:(e,t,r)=>{"use strict";r(245),e.exports=function(e){return e.split("+")}},68:e=>{"use strict";e.exports=function(e){return parseInt(e.substring(13,e.length).trim().substring(0,3))}},113:(e,t,r)=>{"use strict";r(245),e.exports=function(e){return e.match("\\d\\d:\\d\\d")}},284:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var n=r(773),s=r.n(n),o=r(413),i=r.n(o),a=r(750),c=r.n(a),u=r(113),l=r.n(u),g=r(220),p=r.n(g),h=r(990),d=r.n(h),m=r(68),f=r.n(m);const v=class{constructor(){this.getSplitChar=function(){return"/"}}getTimestamp(e){const t={};return t.date=e.substring(0,"07.06.2020".length),t.time=l()(e),c()(t)}parse(e){try{const t=e.replace("  "," ").split(this.getSplitChar()).map((e=>e.trim()));let r=p()(t[1]),n=this.getTimestamp(t[0]),s=f()(t[0]);const o={group:r,timestamp:n,description:d()(e),number:s};return new(i())(o)}catch(t){s().log("error: pageloader parse",t),s().log("info: ",e)}return new(i())({})}}},239:(e,t,r)=>{const n=r(245);e.exports=class{constructor(e,t){this.LodurEntry=e.LodurEntry,this.Chats=e.Chats,this.LogEntry=e.LogEntry,this.logger=t.logger,this.query={entriesThisYear:{timestamp:{$gte:n().startOf("year").toDate()}},entriesLastYear:{timestamp:{$gte:n().startOf("year").subtract(1,"years").toDate()}}}}getLastEntryForYear(){return new Promise(((e,t)=>{this.LodurEntry.find(this.query.entriesThisYear).sort({number:-1}).limit(1).exec((function(r,n){null===r?e(n):t(r)}))}))}getLastEntryForLastYear(){return new Promise(((e,t)=>{this.LodurEntry.find(this.query.entriesLastYear).sort({number:-1}).limit(1).exec((function(r,n){null===r?e(n):t(r)}))}))}getEntriesForActualYear(){return this.LodurEntry.find(this.query.entriesThisYear).sort({number:-1}).exec()}getEntriesForLastYear(){return this.LodurEntry.find(this.query.entriesLastYear).sort({number:-1}).exec()}createNewLodurEntry(e){return new this.LodurEntry(e).save()}findChatsById(e){return new Promise(((t,r)=>{this.Chats.find({chatId:e},((e,n)=>{null!==e?r({"err-find-chats-by-id":e}):t(n)}))}))}findAllChats(){return new Promise(((e,t)=>{this.Chats.find({},((r,n)=>{null!=r?t({"err-find-all-chats":r}):e(n)}))}))}createChat(e){return new this.Chats(e).save()}log(e,t){this.logger.log("debug","persistence-service logged: "+e+" -> "+t),this.LogEntry.create({timestamp:new Date,text:e,error:t},(function(e){null!==e&&this.logger.log("error","persist new received Error",e)}))}}},417:(e,t,r)=>{const n=r(517),s=r(897);class o{constructor(e,t){this.req={},this.req.request=t.request,this.persistenceService=t.persistenceService,this.logger=t.logger,this.bot=this._initBot(e,this.logger),this.logger.log("debug","telegram-bot-service: construction")}_initBot(e,t){t.log("info","binding bot commands");const r=this;return e.onText(/\/start/,(e=>{this.persistenceService.log("telegram-bot-service: cmd start: ",JSON.stringify(e)),this.persistenceService.findChatsById(e.chat.id).then((t=>{0===t.length?this.persistenceService.createChat({chatId:e.chat.id,firstName:e.chat.first_name,lastName:e.chat.last_name,type:e.chat.type,username:e.chat.username}).then((t=>{this.persistenceService.log("info","registered chat id "+e.chat.id),this._send(e.chat.id,"should be registered right now")})).catch((t=>{this.persistenceService.log("error","telegram-bot-service: error occured "+JSON.stringify(t)),this._send(e.chat.id,"should be registered right now")})):(this.persistenceService.log("error","already registered chat id "+e.chat.id),this._send(e.chat.id,"you're registered already, doing nothing..."))})).catch((e=>this.logger.log("error","telegram-bot-service: unknow error occured "+JSON.stringify(e))))})),e.onText(/\/stop/,(e=>{this.persistenceService.log("telegram-bot-service: cmd stop: ",JSON.stringify(e)),this.persistenceService.findChatsById(e.chat.id).then((t=>{n.each(t,(t=>t.remove((t=>{let n="removed you from notification list";t&&(n="error while removing "+t),r._send(e.chat.id,n)}))))}))})),e.onText(/\/stats/,(e=>{this.persistenceService.log("telegram-bot-service: cmd stats: "+JSON.stringify(e)),this.persistenceService.findAllChats().then((t=>{const n="currently, im notifying "+o._chatOrChats(t.length);r._send(e.chat.id,n)})).catch((e=>{console.log("stats",e),r.logger("warn",JSON.stringify(e))}))})),e.onText(/\/update/,(e=>{this.persistenceService.log("telegram-bot-service: cmd update: ",JSON.stringify(e)),this.req.request("http://"+s.getServerIp()+":"+s.getServerPort()+"/update",(()=>{t.log("info","update from bot triggered"),r._send(e.chat.id,"update triggered")})).catch(_errorHandlerText)})),e.on("polling_error",(e=>{t.log("error",e),console.log(e.code)})),e.on("error",(e=>{t.log("error",e),console.log(e.code)})),e}static _chatOrChats(e){const t=e+" chat";return e>1?t+"s":t}notifyAll(e){return new Promise(((t,r)=>{this.persistenceService.findAllChats().then((r=>{r.map((t=>(this._send(t.chatId,e),!0))).every((()=>(t(r),!1)))})).catch((e=>{this.persistenceService.log("telegram-bot-service.notifyAll: error",e),r({"error-find-all-chats":e})}))}))}_send(e,t){this.logger.log("debug","send "+JSON.stringify({id:e,msg:t})),this.bot.sendMessage(e,t).catch((e=>{console.log(e.code),console.log(e.response.body),this.persistenceService.log("telegram-bot-service.send: error",e)}))}}e.exports=o},178:e=>{e.exports=class{constructor(e){this.process=e}setVariableNames(e){this.names=e.slice()}check(){return this.names.filter((e=>void 0===this.process[e]))}}},897:(e,t,r)=>{const n=function(e,t){return e.length>0?e.slice(-1).pop():t},s=function(e){return e.sort((function(e,t){return e.number-t.number})),e};e.exports={getLastEntry:n,getSendArray:function(e,t){const r=[];if(e&&e.length>0){const n=e.slice();s(n),n.reverse().every((function(e){return e.number>t.number&&(r.push(e),!0)}))}return r.reverse()},isOrderingForwards:function(e){return e.length>0&&e[0].number<n(e).number},sortArrayByNumber:s,containsDuplicatedID:function(e){if(!e)return!1;const t=new Set;e.map((e=>t.add(e.number)));const n=!(e.length===t.size);if(n){let n=[];e.map((e=>n.push(e.number)));let i=!1;for(var s of t.keys()){i=!1;for(var o=0;o<n.length;o++)n[o]!==s||i||(n[o]=null,i=!0)}let a=n.filter((e=>null!=e));r(773).log({level:"error",message:"duplicated element found, number: "+a})}return n},getServerIp:()=>process.env.NODE_IP||"localhost",getServerPort:()=>process.env.NODE_PORT||process.env.PORT||8080}},430:e=>{e.exports=class{constructor(e){this.import={express:e.express,persistenceService:e.persistenceService,logger:e.logger}}getRoute(){return(e,t)=>{this.import.persistenceService.getEntriesForActualYear().then((e=>t.json({my_statistic:{type:"integer",value:e?.slice(0,1)[0]?.number??0,label:"EinsÃ¤tze im aktuellen Jahr"}})))}}}},434:(e,t,r)=>{const n=r(517),s=r(245),o=r(897);e.exports=class{constructor(e){this.persistenceService=e.persistenceService,this.pageloader=e.pageloader,this.telegramBot=e.telegramBotService,this.logger=e.logger}getRoute(){return(e,t)=>{let r=n.get(e,"query.silent",!1);this.logger.log("debug","route-update: update requested"),Promise.all([this.persistenceService.getLastEntryForLastYear(),this.pageloader.load("https://www.lodur-zh.ch/duebendorf/index.php?modul=6&year="+s().startOf("year").subtract(1,"years").get("year"))]).then((e=>{try{const n=e[0],i=e[1];let a=[];if(o.containsDuplicatedID(i))this.logger.log("warn","duplicated ID in entries: ",JSON.stringify(a));else{let e={number:-1};1===n.length&&(e=n[0]._doc),a=o.getSendArray(i,e),this.logger.log("info","route-update: elements to send ",a.length),a.length>0?o.sortArrayByNumber(a).forEach((e=>{try{this.logger.log("info","route-update: persisting item nr",e.number);const t={number:e.number,group:e.group,timestamp:e.timestamp,description:e.description};this.persistenceService.createNewLodurEntry(t).then((()=>{this.logger.log("info","route-update: persisted item nr",e.number);const t="Wer:  "+e.group.toString()+"\nWas:  "+e.description+"\nWann: "+s(e.timestamp).locale("de").format("HH:mm DD.MM.YY")+"\nNummer: "+e.number;this.telegramBot.notifyAll(t).then((e=>this.logger.log("info","total "+e.length+" notified")))})).catch((e=>this.logger.log("error","persist new Entry Error"+JSON.stringify(e))))}catch(e){this.logger.log("info","woohwohohwohowow"+e)}})):r&&this.logger.log("debug","no update, latest was: "+JSON.stringify(e))}t.json({newEntries:a})}catch(e){this.logger.log("error","route-update: exception occured: "+JSON.stringify(e)),t.json({"error-catch":e})}})).catch((e=>{this.persistenceService.log("error","route-update Promise.all err: "+JSON.stringify(e)),t.json({error:e})}))}}}},581:(e,t,r)=>{const n=r(517),s=r(245),o=r(897);e.exports=class{constructor(e){this.persistenceService=e.persistenceService,this.pageloader=e.pageloader,this.telegramBot=e.telegramBotService,this.logger=e.logger}getRoute(){return(e,t)=>{let r=n.get(e,"query.silent",!1);this.logger.log("debug","route-update: update requested"),Promise.all([this.persistenceService.getLastEntryForYear(),this.pageloader.load()]).then((e=>{try{const n=e[0],i=e[1];let a=[];if(o.containsDuplicatedID(i))this.logger.log("warn","duplicated ID in entries: ",JSON.stringify(i)),this.logger.log("warn","docs: ",JSON.stringify(n)),this.logger.log("warn","promise result: ",JSON.stringify(e));else{let e={number:-1};1===n.length&&(e=n[0]._doc),a=o.getSendArray(i,e),this.logger.log("info","route-update: elements to send ",a.length),a.length>0?o.sortArrayByNumber(a).forEach((e=>{try{this.logger.log("info","route-update: persisting item nr",e.number);const t={number:e.number,group:e.group,timestamp:e.timestamp,description:e.description};this.persistenceService.createNewLodurEntry(t).then((()=>{this.logger.log("info","route-update: persisted item nr",e.number);const t="Wer:  "+e.group.toString()+"\nWas:  "+e.description+"\nWann: "+s(e.timestamp).locale("de").format("HH:mm DD.MM.YY")+"\nNummer: "+e.number;this.telegramBot.notifyAll(t).then((e=>this.logger.log("info","total "+e.length+" notified")))})).catch((e=>this.logger.log("error","persist new Entry Error"+JSON.stringify(e))))}catch(e){this.logger.log("info","woohwohohwohowow"+e)}})):r&&this.logger.log("debug","no update, latest was: "+JSON.stringify(e))}t.json({newEntries:a})}catch(e){this.logger.log("error","route-update: exception occured: "+JSON.stringify(e)),t.json({"error-catch":e})}})).catch((e=>{this.persistenceService.log("error","route-update Promise.all err: "+JSON.stringify(e)),t.json({error:e})}))}}}},110:(e,t,r)=>{const n=r(185),s=r(109),o=new n.Schema({chatId:String,firstName:String,lastName:String,type:String,username:String});let i;new s(o,"Chat").indexes({chatId:1}),i=n.models.Chat?n.model("Chat"):n.model("Chat",o),e.exports=i},903:(e,t,r)=>{const n=r(185),s=r(109),o=new n.Schema({group:[String],timestamp:Date,description:String,number:Number});let i;new s(o,"LodurEntry").indexes({number:1,timestamp:-1}),i=n.models.LodurEntry?n.model("LodurEntry"):n.model("LodurEntry",o),e.exports=i},637:(e,t,r)=>{const n=r(185),s=r(109),o=new n.Schema({timestamp:Date,text:String,error:{},description:String});let i;new s(o,"LogEntry").indexes({timestamp:1,error:-1}),i=n.models.LogEntry?n.model("LogEntry"):n.model("LogEntry",o),e.exports=i},398:(e,t,r)=>{const n=r(673);class s{connected=new n;constructor(e,t,r){const n=s._stripCredentialsConnectionString(t);e.set("strictQuery",!1),e.connect(t,{useNewUrlParser:!0,useUnifiedTopology:!0}).then((()=>{this.connected.emit("connected"),r.log("info","Succeeded connected to: "+n)}),(e=>{r.log("error","ERROR connecting to: "+n+". "+e),this.connected.emit("error")})).catch((e=>console.log("mongoose-connect: unhandled error",e)))}static _stripCredentialsConnectionString(e){const t=e.indexOf("@");let r=0;return t>0&&(r=t),e.substring(r)}getConnectionStatus(){return this.connected}}e.exports=s},109:(e,t,r)=>{const n=r(517);e.exports=class{constructor(e,t){this.schema=e,e.on("index",(e=>{console.log(t+" index: "+n.get(e,"message","seems ok"))}))}indexes(e){this.schema.index(e)}}},406:(e,t,r)=>{r(252).install()},252:(e,t,r)=>{e=r.nmd(e);var n,s=r(861).SourceMapConsumer,o=r(822);try{(n=r(147)).existsSync&&n.readFileSync||(n=null)}catch(e){}var i=r(144);function a(e,t){return e.require(t)}var c=!1,u=!1,l=!1,g="auto",p={},h={},d=/^data:application\/json[^,]+base64,/,m=[],f=[];function v(){return"browser"===g||"node"!==g&&"undefined"!=typeof window&&"function"==typeof XMLHttpRequest&&!(window.require&&window.module&&window.process&&"renderer"===window.process.type)}function y(e){return function(t){for(var r=0;r<e.length;r++){var n=e[r](t);if(n)return n}return null}}var S=y(m);function b(e,t){if(!e)return t;var r=o.dirname(e),n=/^\w+:\/\/[^\/]*/.exec(r),s=n?n[0]:"",i=r.slice(s.length);return s&&/^\/\w\:/.test(i)?(s+="/")+o.resolve(r.slice(s.length),t).replace(/\\/g,"/"):s+o.resolve(r.slice(s.length),t)}m.push((function(e){if(e=e.trim(),/^file:/.test(e)&&(e=e.replace(/file:\/\/\/(\w:)?/,(function(e,t){return t?"":"/"}))),e in p)return p[e];var t="";try{if(n)n.existsSync(e)&&(t=n.readFileSync(e,"utf8"));else{var r=new XMLHttpRequest;r.open("GET",e,!1),r.send(null),4===r.readyState&&200===r.status&&(t=r.responseText)}}catch(e){}return p[e]=t}));var x=y(f);function w(e){var t=h[e.source];if(!t){var r=x(e.source);r?(t=h[e.source]={url:r.url,map:new s(r.map)}).map.sourcesContent&&t.map.sources.forEach((function(e,r){var n=t.map.sourcesContent[r];if(n){var s=b(t.url,e);p[s]=n}})):t=h[e.source]={url:null,map:null}}if(t&&t.map&&"function"==typeof t.map.originalPositionFor){var n=t.map.originalPositionFor(e);if(null!==n.source)return n.source=b(t.url,n.source),n}return e}function E(e){var t=/^eval at ([^(]+) \((.+):(\d+):(\d+)\)$/.exec(e);if(t){var r=w({source:t[2],line:+t[3],column:t[4]-1});return"eval at "+t[1]+" ("+r.source+":"+r.line+":"+(r.column+1)+")"}return(t=/^eval at ([^(]+) \((.+)\)$/.exec(e))?"eval at "+t[1]+" ("+E(t[2])+")":e}function O(){var e,t="";if(this.isNative())t="native";else{!(e=this.getScriptNameOrSourceURL())&&this.isEval()&&(t=this.getEvalOrigin(),t+=", "),t+=e||"<anonymous>";var r=this.getLineNumber();if(null!=r){t+=":"+r;var n=this.getColumnNumber();n&&(t+=":"+n)}}var s="",o=this.getFunctionName(),i=!0,a=this.isConstructor();if(this.isToplevel()||a)a?s+="new "+(o||"<anonymous>"):o?s+=o:(s+=t,i=!1);else{var c=this.getTypeName();"[object Object]"===c&&(c="null");var u=this.getMethodName();o?(c&&0!=o.indexOf(c)&&(s+=c+"."),s+=o,u&&o.indexOf("."+u)!=o.length-u.length-1&&(s+=" [as "+u+"]")):s+=c+"."+(u||"<anonymous>")}return i&&(s+=" ("+t+")"),s}function N(e){var t={};return Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(r){t[r]=/^(?:is|get)/.test(r)?function(){return e[r].call(e)}:e[r]})),t.toString=O,t}function L(e,t){if(void 0===t&&(t={nextPosition:null,curPosition:null}),e.isNative())return t.curPosition=null,e;var r=e.getFileName()||e.getScriptNameOrSourceURL();if(r){var n=e.getLineNumber(),s=e.getColumnNumber()-1,o=/^v(10\.1[6-9]|10\.[2-9][0-9]|10\.[0-9]{3,}|1[2-9]\d*|[2-9]\d|\d{3,}|11\.11)/.test("object"==typeof process&&null!==process?process.version:"")?0:62;1===n&&s>o&&!v()&&!e.isEval()&&(s-=o);var i=w({source:r,line:n,column:s});t.curPosition=i;var a=(e=N(e)).getFunctionName;return e.getFunctionName=function(){return null==t.nextPosition?a():t.nextPosition.name||a()},e.getFileName=function(){return i.source},e.getLineNumber=function(){return i.line},e.getColumnNumber=function(){return i.column+1},e.getScriptNameOrSourceURL=function(){return i.source},e}var c=e.isEval()&&e.getEvalOrigin();return c?(c=E(c),(e=N(e)).getEvalOrigin=function(){return c},e):e}function _(e,t){l&&(p={},h={});for(var r=(e.name||"Error")+": "+(e.message||""),n={nextPosition:null,curPosition:null},s=[],o=t.length-1;o>=0;o--)s.push("\n    at "+L(t[o],n)),n.nextPosition=n.curPosition;return n.curPosition=n.nextPosition=null,r+s.reverse().join("")}function P(e){var t=/\n    at [^(]+ \((.*):(\d+):(\d+)\)/.exec(e.stack);if(t){var r=t[1],s=+t[2],o=+t[3],i=p[r];if(!i&&n&&n.existsSync(r))try{i=n.readFileSync(r,"utf8")}catch(e){i=""}if(i){var a=i.split(/(?:\r\n|\r|\n)/)[s-1];if(a)return r+":"+s+"\n"+a+"\n"+new Array(o).join(" ")+"^"}}return null}function q(e){var t=P(e),r=function(){if("object"==typeof process&&null!==process)return process.stderr}();r&&r._handle&&r._handle.setBlocking&&r._handle.setBlocking(!0),t&&(console.error(),console.error(t)),console.error(e.stack),"object"==typeof process&&null!==process&&"function"==typeof process.exit&&process.exit(1)}f.push((function(e){var t,r=function(e){var t;if(v())try{var r=new XMLHttpRequest;r.open("GET",e,!1),r.send(null),t=4===r.readyState?r.responseText:null;var n=r.getResponseHeader("SourceMap")||r.getResponseHeader("X-SourceMap");if(n)return n}catch(e){}t=S(e);for(var s,o,i=/(?:\/\/[@#][\s]*sourceMappingURL=([^\s'"]+)[\s]*$)|(?:\/\*[@#][\s]*sourceMappingURL=([^\s*'"]+)[\s]*(?:\*\/)[\s]*$)/gm;o=i.exec(t);)s=o;return s?s[1]:null}(e);if(!r)return null;if(d.test(r)){var n=r.slice(r.indexOf(",")+1);t=i(n,"base64").toString(),r=e}else r=b(e,r),t=S(r);return t?{url:r,map:t}:null}));var C=m.slice(0),M=f.slice(0);t.wrapCallSite=L,t.getErrorSource=P,t.mapSourcePosition=w,t.retrieveSourceMap=x,t.install=function(t){if((t=t||{}).environment&&(g=t.environment,-1===["node","browser","auto"].indexOf(g)))throw new Error("environment "+g+" was unknown. Available options are {auto, browser, node}");if(t.retrieveFile&&(t.overrideRetrieveFile&&(m.length=0),m.unshift(t.retrieveFile)),t.retrieveSourceMap&&(t.overrideRetrieveSourceMap&&(f.length=0),f.unshift(t.retrieveSourceMap)),t.hookRequire&&!v()){var r=a(e,"module"),n=r.prototype._compile;n.__sourceMapSupport||(r.prototype._compile=function(e,t){return p[t]=e,h[t]=void 0,n.call(this,e,t)},r.prototype._compile.__sourceMapSupport=!0)}if(l||(l="emptyCacheBetweenOperations"in t&&t.emptyCacheBetweenOperations),c||(c=!0,Error.prepareStackTrace=_),!u){var s=!("handleUncaughtExceptions"in t)||t.handleUncaughtExceptions;try{!1===a(e,"worker_threads").isMainThread&&(s=!1)}catch(e){}s&&"object"==typeof process&&null!==process&&"function"==typeof process.on&&(u=!0,o=process.emit,process.emit=function(e){if("uncaughtException"===e){var t=arguments[1]&&arguments[1].stack,r=this.listeners(e).length>0;if(t&&!r)return q(arguments[1])}return o.apply(this,arguments)})}var o},t.resetRetrieveHandlers=function(){m.length=0,f.length=0,m=C.slice(0),f=M.slice(0),x=y(f),S=y(m)}},167:e=>{"use strict";e.exports=require("axios")},986:e=>{"use strict";e.exports=require("body-parser")},144:e=>{"use strict";e.exports=require("buffer-from")},48:e=>{"use strict";e.exports=require("cheerio")},710:e=>{"use strict";e.exports=require("cookie-parser")},316:e=>{"use strict";e.exports=require("express-winston")},517:e=>{"use strict";e.exports=require("lodash")},245:e=>{"use strict";e.exports=require("moment")},185:e=>{"use strict";e.exports=require("mongoose")},159:e=>{"use strict";e.exports=require("node-telegram-bot-api")},916:e=>{"use strict";e.exports=require("serve-favicon")},861:e=>{"use strict";e.exports=require("source-map")},261:e=>{"use strict";e.exports=require("source-map-support")},773:e=>{"use strict";e.exports=require("winston")},147:e=>{"use strict";e.exports=require("fs")},673:e=>{"use strict";e.exports=require("node:events")},822:e=>{"use strict";e.exports=require("path")}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={id:n,loaded:!1,exports:{}};return e[n](o,o.exports,r),o.loaded=!0,o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var n={};(()=>{"use strict";r.r(n),r.d(n,{default:()=>G});var e=r(773),t=r.n(e);r(413),r(874),r(633),r(701),r(797),r(17),r(406);var s=r(239),o=r.n(s),i=r(417),a=r.n(i),c=r(903),u=r.n(c),l=r(110),g=r.n(l),p=r(637),h=r.n(p),d=r(517),m=r.n(d);const f=require("request");var v=r.n(f);const y=require("express");var S=r.n(y);const b=r(637),x=r(897);var w=r(581),E=r.n(w),O=r(434),N=r.n(O),L=r(430),_=r.n(L),P=r(897),q=r.n(P),C=r(398),M=r.n(C);r(261).install();const j=r(159),R=r(178);process.on("uncaughtException",(function(e){h().create({timestamp:new Date,text:"app.js - uncaughtException",error:JSON.stringify(e),description:m().get(e,"message","nomessage")+"\nstack:\n"+m().get(e,"stack","nostack")},(function(e){null!==e&&console.log("persist new Entry ",e)})),console.error((new Date).toUTCString()+" uncaughtException:"),console.error(e),console.error(e.message),console.error(e.stack)}));const D=r(822),T=(r(916),r(316),r(710)),k=r(986),Y=r(185),F=new(r(377).default),I=S()(),J=t().createLogger({level:"info",format:t().format.json(),defaultMeta:{service:"user-service"},transports:[new(t().transports.Console)({colorize:!0,level:"debug"}),new(t().transports.File)({filename:"error.log",level:"error"}),new(t().transports.File)({filename:"combined.log"})]});I.use(k.json()),I.use(k.urlencoded({extended:!1})),I.use(T()),I.use(S().static(D.join(__dirname,"public")));const B=new j(process.env.telegram_hash,{polling:!0}),A={express:S(),pageloader:F,persistenceService:new(o())({Chats:g(),LogEntry:h(),LodurEntry:u()},{logger:J}),logger:J,request:v(),telegramBotService:null};A.telegramBotService=new(a())(B,A);const H=S().Router();H.get("/",new class{constructor(e){this.import={express:e.express,pageloader:e.pageloader}}getRoute(){return(e,t)=>{this.import.pageloader.load().then((e=>{t.setHeader("charset","utf8"),x.containsDuplicatedID(e)&&t.json({error:"More than once the same >Einsatznummer<.\n Please contact admin (to check logs).\n If your a lodur admin, check that each number is unique."}),t.json(e)}),(function(e){b.create({timestamp:new Date,text:"index - pageloader exception",error:JSON.stringify(e),description:m().get(e,"message","nomessage")+"\nstack:\n"+m().get(e,"stack","nostack")},(function(e){null!=e&&console.log("not able to write log Entry ",e)})),t.json({error:e})}))}}}(A).getRoute()),H.get("/update",new(E())(A).getRoute()),H.get("/update-last-year",new(N())(A).getRoute()),H.get("/stats-dasheroo",new(_())(A).getRoute()),I.use("/",H),I.use((function(e,t,r){J.log("warn","errorhandler ",e.originalUrl);const n=new Error("Not Found");n.status=404,r(n)}));const U=new R(process.env);U.setVariableNames(["MONGOURI","telegram_hash"]);const z=U.check();z.length>0&&J.log("warn","missing process.env variables: ",z),Y.Promise=global.Promise,global.Promise;const W=process.env.MONGOURI||"mongodb://localhost:27017/lodur",$=new(M())(Y,W,J);"development"===I.get("env")?(J.level="silly",J.warn("env:development"),Y.set("debug",!0),I.use((function(e,t,r,n){r.status(e.status||500),r.json({message:e.message,error:e})}))):I.use((function(e,t,r,n){J.log("error",e),r.status(e.status||500),r.json({message:e.message,error:{}})})),$.getConnectionStatus().prependOnceListener("connected",(e=>{I.listen(q().getServerPort(),q().getServerIp(),(function(){J.log("info","Listening on server_port: "+q().getServerPort()),J.log("info","Listening on server_ip_address: "+q().getServerIp())}))}));const G=I})();var s=exports;for(var o in n)s[o]=n[o];n.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})})();
//# sourceMappingURL=app.bundle.js.map